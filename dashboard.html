<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8"><title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body class="bg-gray-50">
    <nav class="bg-white p-4 shadow flex justify-between items-center">
        <h2 class="text-xl font-bold text-blue-600 italic">DZ-TRAFFIC</h2>
        <div class="bg-yellow-100 text-yellow-800 px-4 py-1 rounded-full font-bold text-lg">
            Ø±ØµÙŠØ¯Ùƒ: <span id="pts">0</span> ðŸª™
        </div>
    </nav>
    <div class="max-w-md mx-auto p-6" id="adsContainer">
        </div>
    <script>
        const _supabase = supabase.createClient("YOUR_SUPABASE_URL", "YOUR_SUPABASE_KEY");
        async function load() {
            const { data: { user } } = await _supabase.auth.getUser();
            const { data: prof } = await _supabase.from('profiles').select('points').eq('id', user.id).single();
            document.getElementById('pts').innerText = prof.points;

            const { data: ads } = await _supabase.from('ads').select('*');
            ads.forEach(ad => {
                const div = document.createElement('div');
                div.className = "bg-white p-4 rounded-2xl shadow mb-3 flex justify-between items-center";
                div.innerHTML = `<span>${ad.title}</span><button onclick="viewAd('${ad.url}', ${ad.id})" id="btn-${ad.id}" class="bg-blue-600 text-white px-4 py-2 rounded-xl font-bold">+${ad.reward}</button>`;
                document.getElementById('adsContainer').appendChild(div);
            });
        }
        function viewAd(url, id) {
            window.open(url, '_blank');
            let sec = 30;
            const b = document.getElementById(`btn-${id}`);
            b.disabled = true;
            const t = setInterval(async () => {
                b.innerText = `${sec}Ø«`;
                if (sec-- <= 0) {
                    clearInterval(t);
                    const { data: { user } } = await _supabase.auth.getUser();
                    await _supabase.rpc('increment_points', { user_id: user.id, row_points: 100 });
                    location.reload();
                }
            }, 1000);
        }
        load();
    </script>
</body>
</html>
