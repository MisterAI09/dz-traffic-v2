<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | DZ-TRAFFIC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@700;900&display=swap" rel="stylesheet">
    <style>body { font-family: 'Tajawal', sans-serif; }</style>
</head>
<body class="bg-slate-100 pb-10 text-right">
    <nav class="bg-white p-4 shadow-sm flex justify-between items-center sticky top-0 z-50 border-b border-blue-100">
        <h2 class="font-black text-blue-600 italic">DZ-TRAFFIC</h2>
        <div class="bg-yellow-400 text-white px-4 py-1 rounded-full font-bold shadow-sm ring-2 ring-white">ğŸª™ <span id="balance">0</span></div>
    </nav>

    <div class="max-w-md mx-auto p-4 space-y-6">
        <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-white">
            <h3 class="font-black mb-3 text-gray-800">ğŸš€ Ø§Ù†Ø´Ø± Ø±Ø§Ø¨Ø·Ùƒ (ØªÙ„ÙŠØ¬Ø±Ø§Ù…ØŒ ÙŠÙˆØªÙŠÙˆØ¨...)</h3>
            <select id="pType" class="w-full p-3 bg-gray-50 border rounded-xl mb-2 text-xs font-bold outline-none">
                <option value="ğŸ“¢ ØªÙ„ÙŠØ¬Ø±Ø§Ù…">ğŸ“¢ ØªÙ„ÙŠØ¬Ø±Ø§Ù…</option>
                <option value="ğŸ“º ÙŠÙˆØªÙŠÙˆØ¨">ğŸ“º ÙŠÙˆØªÙŠÙˆØ¨</option>
                <option value="ğŸŒ Ù…ÙˆÙ‚Ø¹">ğŸŒ Ù…ÙˆÙ‚Ø¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</option>
                <option value="ğŸ“¸ Ø¥Ù†Ø³ØªØºØ±Ø§Ù…">ğŸ“¸ Ø¥Ù†Ø³ØªØºØ±Ø§Ù…</option>
            </select>
            <input type="text" id="aTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" class="w-full p-3 border rounded-xl mb-2 text-xs outline-none">
            <input type="url" id="aUrl" placeholder="Ø¶Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§" class="w-full p-3 border rounded-xl mb-3 text-xs outline-none">
            <button onclick="addAd()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-black text-sm shadow-lg active:scale-95 transition">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (-2000 Ù†Ù‚Ø·Ø©)</button>
        </div>

        <div id="adsList" class="space-y-3">
            <h3 class="font-black text-gray-700 px-2 flex justify-between items-center">
                <span>ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· ğŸ”¥</span>
                <span class="text-[9px] bg-blue-100 text-blue-600 px-2 py-1 rounded">Ø²ÙŠØ§Ø±Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©</span>
            </h3>
            </div>

        <a href="https://t.me/MouzaiaDelivery" target="_blank" class="block bg-sky-500 text-white text-center py-4 rounded-2xl font-black shadow-lg hover:bg-sky-600 transition">Ø§ØªØµÙ„ Ø¨Ù†Ø§ Ø¹Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù… ğŸ’¬</a>
    </div>

    <script>
        const _s = supabase.createClient("https://nbioqaxgjzpyrbcwdkds.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5iaW9xYXhnanpweXJiY3dka2RzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDY4NzgwOTgsImV4cCI6MjAyMjQ1NDA5OH0.X-S_q6X9-X_q6X9-X_q6X9-X_q6X9");

        async function init() {
            const { data: { user } } = await _s.auth.getUser();
            if(!user) return window.location.href="index.html";

            const { data: p } = await _s.from('profiles').select('points').eq('id', user.id).single();
            document.getElementById('balance').innerText = (p?.points || 0).toLocaleString();

            const { data: ads } = await _s.from('ads').select('*').order('id', {ascending: false});
            const list = document.getElementById('adsList');
            ads.forEach(ad => {
                const div = document.createElement('div');
                div.className = "bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm border border-gray-50 hover:border-blue-200 transition";
                div.innerHTML = `<div class="text-right"><p class="font-black text-xs text-gray-700">${ad.title}</p><p class="text-[9px] text-gray-400 font-bold">â±ï¸ ${ad.required_time} Ø«Ø§Ù†ÙŠØ©</p></div>
                    <button onclick="go('${ad.url}', ${ad.id}, ${ad.reward_points}, ${ad.required_time})" id="b-${ad.id}" class="bg-blue-600 text-white px-5 py-2 rounded-xl font-bold text-xs shadow-sm">+${ad.reward_points}</button>`;
                list.appendChild(div);
            });
        }

        async function addAd() {
            const { data: { user } } = await _s.auth.getUser();
            const { error } = await _s.from('ads').insert({ 
                title: document.getElementById('pType').value + ": " + document.getElementById('aTitle').value, 
                url: document.getElementById('aUrl').value, 
                reward_points: 50, required_time: 15 
            });
            if (!error) {
                await _s.rpc('increment_points', { user_id: user.id, row_points: -2000 });
                alert("ØªÙ… Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ!"); location.reload();
            }
        }

        function go(u, id, r, t) {
            window.open(u, '_blank');
            let s = t; const btn = document.getElementById(`b-${id}`); btn.disabled = true;
            const timer = setInterval(async () => {
                btn.innerText = `${s--}Ø«`;
                if (s < 0) {
                    clearInterval(timer);
                    const { data: { user } } = await _s.auth.getUser();
                    await _s.rpc('increment_points', { user_id: user.id, row_points: r });
                    location.reload();
                }
            }, 1000);
        }
        init();
    </script>
</body>
</html>
