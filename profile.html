<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ | DZ-TRAFFIC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body class="bg-blue-50 flex items-center justify-center min-h-screen">
    <div class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-md">
        <h2 class="text-2xl font-bold text-center mb-6">Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ§Ø³ØªÙ„Ù… 10,000 Ù†Ù‚Ø·Ø© ğŸ</h2>
        <form id="profileForm" class="space-y-4">
            <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)" class="w-full p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-500" required>
            <input type="tel" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±)" class="w-full p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-500" required>
            <button type="submit" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-blue-700 transition">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ù‡Ø¯ÙŠØ© ğŸš€</button>
        </form>
    </div>

    <script>
        const SUPABASE_URL = "https://nbioqaxgjzpyrbcwdkds.supabase.co";
        const SUPABASE_KEY = "Ø¶Ù€Ø¹_Ù…Ù€ÙÙ€ØªÙ€Ø§Ø­_ANON_Ø§Ù„Ù€Ø®_Ø§Øµ_Ø¨Ù€Ùƒ_Ù‡Ù€Ù†Ù€Ø§";
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        document.getElementById('profileForm').onsubmit = async (e) => {
            e.preventDefault();
            
            // Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¬Ù‡Ø§Ø²
            if (localStorage.getItem('dz_user_registered')) {
                alert("Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„!");
                window.location.href = "dashboard.html";
                return;
            }

            const { data: { user } } = await _supabase.auth.getUser();
            if (!user) return window.location.href = "index.html";

            const { error } = await _supabase.from('profiles').upsert({
                id: user.id,
                username: document.getElementById('username').value,
                phone: document.getElementById('phone').value,
                points: 10000 // Ø§Ù„Ù‡Ø¯ÙŠØ©
            });

            if (!error) {
                localStorage.setItem('dz_user_registered', 'true');
                window.location.href = "dashboard.html";
            } else {
                alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: " + error.message);
            }
        };
    </script>
</body>
</html>
